// Test cases for pattern variable type inference errors

type Result<T, E> = variant {
    Ok(value: T),
    Err(error: E)
}

type Point = struct {
    x: f32,
    y: f32
}

// ============================================================================
// Type Mismatch Errors
// ============================================================================

// Trying to destructure non-array as array
fn testNonArrayAsArray(val: u32) {
    
    
    match val {
        /// @Error(TCE120): Pattern expects array type
        [
            /// @Error(TCE120): Pattern expects array type, but got 'u32'
            first, 
            /// @Error(TCE120): Pattern expects array type, but got 'u32'
            second,
            1,
            "cool"
        ] => {},
        _ => {}
    }
}

// Trying to destructure non-struct as struct
fn testNonStructAsStruct(val: u32) {
    match val {
        /// @Error(TCE120): Pattern expects struct type
        {x: xVal, 
        /// @Error(TCE120): Pattern expects struct type
        y: yVal} => {},
        _ => {}
    }
}

// Wrong number of parameters in variant constructor pattern
fn testWrongParamCount(result: Result<u32, string>) {
    match result {
        /// @Error(TCE120): Too many parameters in pattern 
        Result.Ok(a, b) => {},
        _ => {}
    }
}

// Field not found in struct pattern
fn testFieldNotFound(p: Point) {
    match p {
        /// @Error(TCE120): Field 'z' not found in struct type
        {x: xVal, y: yVal, z: zVal} => {},
        _ => {}
    }
}

// ============================================================================
// Generic Type Mismatch
// ============================================================================

// Using wrong type for variant pattern variable
fn testVariantTypeMismatch(result: Result<u32, string>) {
    match result {
        Result.Ok(value) => {
            /// @Error(TCE006): Variable 'x' type mismatch
            let x: string = value
        },
        _ => {}
    }
}

// Array element type mismatch
fn testArrayElementMismatch(arr: u32[]) {
    match arr {
        [first, second] => {
            /// @Error(TCE006): Variable 'x' type mismatch
            let x: string = first
        },
        _ => {}
    }
}