// Test lvalue validation

    
type Point = class { 
    let x: u32, y: u32 
    fn init(x: u32, y: u32) {
        this.{x: x, y: y}
    }
}

type  MyClass = class {
    let mutableField: u32
    let const immutableField: u32

    fn init(a: u32, b: u32) {
        this.{
            mutableField: a,
            immutableField: b
        }

        this.immutableField = 1

        /// Error:
        this = new MyClass(1, 2)
    }

    fn get(){
        /// @Error(TCE191): Const attributes can only be assigned in constructors
        this.{immutableField: 1}
    }
}

fn main() {
    // Valid assignments
    let x = 10
    x = 20  // OK - mutable variable

    let arr = [1, 2, 3]
    arr[0] = 5  // OK - array element

    // Invalid assignments - literals

    /// @Error(TCE190): Cannot assign to literal value
    10 = 5  // ERROR: Cannot assign to literal value
    /// @Error(TCE190): Cannot assign to literal value
    "hello" = "world"  // ERROR: Cannot assign to literal value
    /// @Error(TCE190): Cannot assign to literal value
    true = false  // ERROR: Cannot assign to literal value

    // Invalid assignments - const variables
    let const y = 30
    /// @Error(TCE191): Cannot assign to const
    y = 40  // ERROR: Cannot assign to const variable

    // Invalid assignments - function calls
    fn getId() -> u32 = 42
    /// @Error(TCE190): Cannot assign to 
    getId() = 100  // ERROR: Cannot assign to function call result

    // Invalid assignments - expressions
    /// @Error(TCE190): Cannot assign to 
    x + 10 = 5  // ERROR: Cannot assign to expression result
    /// @Error(TCE190): Cannot assign to 
    x * 2 = 10  // ERROR: Cannot assign to expression result

    // Invalid assignments - type casts
    /// @Error(TCE190): Cannot assign to 
    x as u64 = 100  // ERROR: Cannot assign to cast expression result

    // Invalid assignments - 'this'
    // this = something  // ERROR: Cannot assign to 'this'

    // Invalid assignments - unary expressions
    
    /// @Error(TCE190): Cannot assign to 
    ~x = 5  // ERROR: Cannot assign to unary expression result

    // Invalid assignments - new expression
    /// @Error(TCE190): Cannot assign to 
    new Point(0, 0) = new Point(1, 1)  // ERROR: Cannot assign to new expression result

    // Invalid assignments - match expression
    /// @Error(TCE190): Cannot assign to 
    match x {
        10 => x,
        _ => 0
    } = 5  // ERROR: Cannot assign to expression result

    // Invalid assignments - if expression
    /// @Error(TCE190): Cannot assign to 
    if x > 5 => x else 0 = 10  // ERROR: Cannot assign to expression result

    // Invalid assignments - iterator variables
    foreach i, v in [1, 2, 3] {
        /// @Error(TCE192): Cannot assign to 
        i = 10  // ERROR: Cannot assign to iterator variable

        /// @Error(TCE192): Cannot assign to 
        v = 10
    }

    // Valid assignments - member access
  
    let obj = new MyClass(1, 2)
    obj.mutableField = 100  // OK - mutable attribute
    /// @Error(TCE191): Cannot assign to 
    obj.immutableField = 200  // ERROR: Cannot assign to const attribute

    let const z: {x: u32, y:u32} = {1, 2}

    /// @Error(TCE191): Cannot assign to const variable
    z = {2, 3}

    z.x = 1


    // Const base member access
    let const constStruct = {x: 1, y: 2}
    /// @Error(TCE191): The variable is declared as const
    constStruct.x = 10  // ERROR: Cannot assign to member of const variable
    
    let mutableStruct = {x: 1, y: 2}
    mutableStruct.x = 10  // OK - mutable variable

    // Nested member access with const base
    let const constNested = {inner: {value: 42}}
    /// @Error(TCE191): The variable is declared as const
    constNested.inner.value = 100  // ERROR: Cannot assign to member of const variable
    
    let mutableNested = {inner: {value: 42}}
    mutableNested.inner.value = 100  // OK - mutable variable

    // Function parameters - const by default
    fn testParams(x: u32, mut y: u32) {
        /// @Error(TCE191): Parameters are immutable by default
        x = 10  // ERROR: Cannot assign to parameter - immutable by default
        y = 20  // OK - marked with 'mut'
    }
    // Function parameters with member access
    fn testParamMembers(obj: MyClass, mut mutObj: MyClass) {
        /// @Error(TCE191): Parameters are immutable by default
        obj.mutableField = 1  // ERROR: Cannot assign to member of const parameter
        mutObj.mutableField = 2  // OK - parameter is mutable
    }
    // Nested const propagation with parameters
    fn testNestedParams(point: {x: u32, y: {nested: u32}}) {
        /// @Error(TCE191): Parameters are immutable by default
        point.x = 1  // ERROR: Cannot assign to member of const parameter
        /// @Error(TCE191): Parameters are immutable by default
        point.y.nested = 2  // ERROR: Cannot assign to member of const parameter (propagates)
    }
}