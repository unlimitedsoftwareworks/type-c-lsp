from std.string import String
from std.io import println
from std.unit.test import TestUnit, UnitSet

fn spilled_func(x0: u32,x1: u32,x2: u32,x3: u32,x4: u32,x5: u32,x6: u32,x7: u32,x8: u32,x9: u32,x10: u32,x11: u32,x12: u32,x13: u32,x14: u32,x15: u32,x16: u32,x17: u32,x18: u32,x19: u32,x20: u32,x21: u32,x22: u32,x23: u32,x24: u32,x25: u32,x26: u32,x27: u32,x28: u32,x29: u32,x30: u32,x31: u32,x32: u32,x33: u32,x34: u32,x35: u32,x36: u32,x37: u32,x38: u32,x39: u32,x40: u32,x41: u32,x42: u32,x43: u32,x44: u32,x45: u32,x46: u32,x47: u32,x48: u32,x49: u32,x50: u32,x51: u32,x52: u32,x53: u32,x54: u32,x55: u32,x56: u32,x57: u32,x58: u32,x59: u32,x60: u32,x61: u32,x62: u32,x63: u32,x64: u32,x65: u32,x66: u32,x67: u32,x68: u32,x69: u32,x70: u32,x71: u32,x72: u32,x73: u32,x74: u32,x75: u32,x76: u32,x77: u32,x78: u32,x79: u32,x80: u32,x81: u32,x82: u32,x83: u32,x84: u32,x85: u32,x86: u32,x87: u32,x88: u32,x89: u32,x90: u32,x91: u32,x92: u32,x93: u32,x94: u32,x95: u32,x96: u32,x97: u32,x98: u32,x99: u32,x100: u32,x101: u32,x102: u32,x103: u32,x104: u32,x105: u32,x106: u32,x107: u32,x108: u32,x109: u32,x110: u32,x111: u32,x112: u32,x113: u32,x114: u32,x115: u32,x116: u32,x117: u32,x118: u32,x119: u32,x120: u32,x121: u32,x122: u32,x123: u32,x124: u32,x125: u32,x126: u32,x127: u32,x128: u32,x129: u32,x130: u32,x131: u32,x132: u32,x133: u32,x134: u32,x135: u32,x136: u32,x137: u32,x138: u32,x139: u32,x140: u32,x141: u32,x142: u32,x143: u32,x144: u32,x145: u32,x146: u32,x147: u32,x148: u32,x149: u32,x150: u32,x151: u32,x152: u32,x153: u32,x154: u32,x155: u32,x156: u32,x157: u32,x158: u32,x159: u32,x160: u32,x161: u32,x162: u32,x163: u32,x164: u32,x165: u32,x166: u32,x167: u32,x168: u32,x169: u32,x170: u32,x171: u32,x172: u32,x173: u32,x174: u32,x175: u32,x176: u32,x177: u32,x178: u32,x179: u32,x180: u32,x181: u32,x182: u32,x183: u32,x184: u32,x185: u32,x186: u32,x187: u32,x188: u32,x189: u32,x190: u32,x191: u32,x192: u32,x193: u32,x194: u32,x195: u32,x196: u32,x197: u32,x198: u32,x199: u32,x200: u32,x201: u32,x202: u32,x203: u32,x204: u32,x205: u32,x206: u32,x207: u32,x208: u32,x209: u32,x210: u32,x211: u32,x212: u32,x213: u32,x214: u32,x215: u32,x216: u32,x217: u32,x218: u32,x219: u32,x220: u32,x221: u32,x222: u32,x223: u32,x224: u32,x225: u32,x226: u32,x227: u32,x228: u32,x229: u32,x230: u32,x231: u32,x232: u32,x233: u32,x234: u32,x235: u32,x236: u32,x237: u32,x238: u32,x239: u32,x240: u32,x241: u32,x242: u32,x243: u32,x244: u32,x245: u32,x246: u32,x247: u32
    ) -> u32 
{
    let z = x0 + x1 + x2 + x204
    let y = x3 + x4 + x5 + x206
    let x = y+z
    return x
}

fn test1(runner: TestUnit) {

    let val: u64 = 0
    let len: u64 = 10
    for let i: u64 = val; i < len; i += 1 {
        runner.assert_eq<u64>(i, i)
        runner.assert_eq<u64>(len, 10)
    }
}


fn test2(runner: TestUnit) {
    let res = spilled_func(
        0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,
        26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,
        51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,
        76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,
        101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,
        126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,
        151,152,153,154,155,156,157,158,159,160,161,162,163,164,165,166,167,168,169,170,171,172,173,174,175,
        176,177,178,179,180,181,182,183,184,185,186,187,188,189,190,191,192,193,194,195,196,197,198,199,200,
        201,202,203,204,205,206,207,208,209,210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,225,
        226,227,228,229,230,231,232,233,234,235,236,237,238,239,240,241,242,243,244,245,246,247)

    runner.assert_eq<u32>(425, res)
}

/**
 * if-else expressions sometimes cause problems with register allocation
 * this test ensures that they are handled correctly
 */
fn test3(runner: TestUnit) {
    let x: i32 = 3
    let z = if x == 1 => "Hello World" else if x == 2 => "hi" else  "Hello World 2"
    runner.assert_obj_eq<String>(z, "Hello World 2")
    x = 2
    z = if x == 1 => "Hello World" else if x == 2 => "hi" else  "Hello World 2"
    runner.assert_obj_eq<String>(z, "hi")
    x = 1
    z = if x == 1 => "Hello World" else if x == 2 => "hi" else  "Hello World 2"
    runner.assert_obj_eq<String>(z, "Hello World")
}

fn main() {
    let test_1 = new TestUnit("test 1", "Test register allocation with jumps", test1)
    let test_2 = new TestUnit("test 2", "Test register allocation with spilling", test2)
    let test_3 = new TestUnit("test 3", "Tests basic if-else expression usage", test3)

    let set = new UnitSet("STD Test 0", "Tests basic language constructors", [test_1, test_2, test_3])
    return set.run()
}

